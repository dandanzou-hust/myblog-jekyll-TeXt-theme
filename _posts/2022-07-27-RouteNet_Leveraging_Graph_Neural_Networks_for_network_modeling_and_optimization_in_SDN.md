---
title:  "【文献阅读】RouteNet"
date:   2022-7-27 12:00:00 +0800
key: RouteNet_Leveraging_Graph_Neural_Networks_for_network_modeling_and_optimization_in_SDN
categories: 文献阅读
tag: "GNN"
---
# 引言

预发表版本：Unveiling the potential of Graph Neural Networks for network modeling and optimization in SDN
正刊（通信顶刊Top1）IEEE Journal on Selected Areas in Communications：
RouteNet: Leveraging Graph Neural Networks for network modeling and optimization in SDN

看到了好几篇文章都借鉴了这篇论文，SDN中使用GNN做特征，引用量98。

# Abstract

**网络建模**是在未来自动驾驶软件定义网络中实现高效网络运行的关键促成因素。然而，我们仍然缺乏能够以有限的成本准确预测关键性能指标（KPI）的功能网络模型，如延迟、抖动或损耗。在本文中，我们提出了RouteNet，这是一种基于图神经网络（GNN）的新型网络模型，能够理解**拓扑、路由和输入流量**之间的复杂关系，以准确估计每个源/目标每个包的延迟分布和损耗。RouteNet利用GNN学习和建模图形结构化信息的能力，因此，我们的模型能够概括任意拓扑、路由方案和流量强度。在我们的评估中，我们表明RouteNet能够准确预测延迟分布（平均延迟和抖动）和损失，即使是在拓扑、路由和训练中看不到的流量中（最坏情况下MRE=15.4%）。此外，我们还介绍了几个用例，在这些用例中，我们利用GNN模型的KPI预测来实现高效的路由优化和网络规划。

> 这篇论文就是训练一个GNN，输入拓扑、路由、流量，输出预测的延迟、抖动。

# Introduction

## Motivation

**网络建模**是实现高效网络优化的基本组成部分，特别关注未来的自动驾驶网络[1]。在软件定义的网络环境中，网络任务是从集中控制平面编排的，集中控制平面可以利用网络状态的全局图，以便高效、动态地运行网络以适应网络中的变化。为此，网络管理员通常定义一个目标策略，该策略可能包括一些优化目标（例如，最小化端到端延迟）和约束（例如，安全策略）。然后，SDN控制器的任务是发现网络配置（例如路由）中的一些变化，以实现管理员设定的优化目标。这通过结合两个主要元素实现：（i）网络模型和（ii）优化算法。在这个众所周知的优化架构中，网络模型的任务是预测特定配置的最终性能（例如，延迟、丢包），优化算法迭代探索不同的配置，直到找到满足优化目标的配置。

网络优化解决方案的一个基本问题是，它们只能基于网络模型提供的性能指标进行优化。因此，为了优化关键性能指标（KPI），例如网络中的延迟或数据包丢失，网络模型必须能够理解这些性能指标与从数据平面收集的网络状态度量之间的关系，数据平面通常只能提供真实部署中的流量（例如，流量矩阵）的及时统计信息。在这种情况下，过去一直致力于构建能够预测性能指标的网络模型，但现在我们仍然缺乏能够准确预测延迟、抖动或数据包丢失等相关KPI的功能模型。主要基于排队论[2]的分析模型假设了网络的一些非现实特性（例如，泊松分布的流量、概率路由），因此，在具有现实配置（如多跳路由[3]）的大规模网络中，它们无法准确地生成KPI预测。相反，**数据包级网络模拟器**在这方面非常准确，但其高计算成本使其无法在短时间内运行网络。

> 论文强调，现有都是理想且简化的模型，大型网络中仍没有实用的模型用于准确的KPIs。

在这种情况下，深度学习[4]似乎是一种非常适合开发新一代网络模型的替代方法，这种模型既准确又轻量级。相关研究工作正在致力于将神经网络应用于计算机网络建模[5]，并使用此类模型进行网络优化[6]、[7]、[3]。现有提案[8]、[9]通常使用众所周知的神经网络（NN）架构，如全连接神经网络、卷积神经网络、递归神经网络或变分自编码器。然而，计算机网络基本上是用图表示的，这种类型的神经网络并不是为了学习图结构信息而设计的。因此，训练后的模型精度有限，无法概括拓扑或路由配置。

在本文中，我们提出了RouteNet，一种基于图神经网络（GNN）[10]的新型网络模型。我们的模型能够理解拓扑、路由和输入流量之间的复杂关系，以准确估计每个信源-目的地对上的每个数据包延迟和丢失率的分布。GNN经过裁剪，可以在图[11]结构的信息上实现关系推理和组合泛化，因此我们的模型能够在任意拓扑、路由方案和可变流量强度上进行泛化。特别是，RouteNet捕捉网络拓扑上有意义的流量路由。这是通过建模拓扑中链路与路由方案产生的源-目的路径以及流经它们的流量之间的关系来实现的。与其他基于GNN的模型[12]相比，**RouteNet架构的一个主要贡献是将路径表示为有序的链路序列。这使得RouteNet成为一种新的GNN架构，专门用于计算机网络控制和管理。**

本文的早期版本见[13]。在该版本中，使用了两种不同的模型来预测每条路径的平均延迟和抖动。在本文中，我们提出了一个受广义线性模型启发的扩展路由网络模型，该模型直接估计每条路径上延迟的每包分布。这使得能够使用单个模型来预测与端到端每数据包延迟（例如，平均延迟、抖动）相关的任何度量。此外，在本文中，我们采用RouteNet来预测每个源/目标的丢包率。

> 和自己之前预发表的论文做对比，之前那篇是两个模型分开预测延迟和抖动，这里合并了。

我们使用使用数据包级模拟器（Omnet++[14]）生成的数据集评估了GNN模型的准确性，这导致在针对拓扑、路由和训练期间未看到的流量进行测试时，延迟、抖动和丢失的估计精度很高。更重要的是，我们验证了我们的模型能够泛化，例如，当使用14节点、24节点和50节点拓扑的样本训练模型时，该模型能够在从未见过的17节点网络中提供准确的估计（最坏情况下MRE=15.4%）。

最后，为了展示我们的GNN模型的潜力，我们提出了一系列适用于SDN架构的用例。与[13]中介绍的用例不同，本文中包括了网络场景，这些场景还利用了新的路由网络模型，该模型预测数据包丢失，以执行平均延迟、抖动和丢失的联合优化。我们首先证明了RouteNet可以用于优化具有延迟、抖动和丢失需求的QoS感知场景中的路由配置，并将其与传统的效用感知模型（例如OSPF）和使用数据包级模拟器的最优解决方案进行比较。此外，我们在网络规划用例中利用RouteNet的预测来选择最佳链路位置。

我们总结了与前一篇论文相比，本文的主要贡献和最新技术：

- 受广义线性模型启发的概率建模
- 适应每个源/目标丢包率的预测
- 剩余连接以促进培训（如ResNet[15]）
- 计算成本提高（10 更快）
- 其他输入功能（支持任意链路容量）
- 结合丢包要求的新网络优化用例。
- 更多样化和更大的网络拓扑（具有14、17、24和50个节点）

# 基于SDN的建模和优化场景

**网络建模使控制平面能够进一步利用SDN执行细粒度管理的潜力。** 这允许评估**what-if场景**的结果性能，而无需修改数据平面的状态。它可能对许多网络管理应用程序有利，例如优化、规划或快速故障恢复。例如，在图1中，我们展示了在知识定义网络（KDN）范式[22]的背景下执行网络优化的用例架构。在这种情况下，我们**假设控制平面接收到网络状态的及时更新**（例如，流量矩阵、延迟测量）。这可以通过“传统的”基于SDN的测量技术（例如OpenFlow[20]、OpenSketch[34]）或更新颖的遥测方案（例如用于P4[16]或iOAM[1]的INT）实现。同样，在知识平面中有一个优化器，其行为由给定的目标策略定义。
该策略与基于意图的网络相一致，可由声明性语言（如NEMO[2]）定义，并最终转化为（多目标）网络优化问题。在这一点上，准确的网络模型可以在优化过程中发挥关键作用，通过利用它来运行优化算法（例如爬山），迭代探索候选解决方案的性能，以找到最佳配置。我们有意将培训阶段排除在该架构的范围之外。

> Control plane 可以做一些假设性质的场景分析，而不需要对实际场景进行修改。
>
> 需要看一下KDN
>
> 简单的事写的高大上，说话的艺术^_^

![](https://zdd-1300938198.cos.ap-beijing.myqcloud.com//my-picture-bed/20220729114838.png)

为了在上述场景中取得成功，网络模型应满足两个主要要求：

（i） 提供准确的结果

（ii）具有较低的计算成本，允许网络优化器在短时间内运行。

此外，优化器必须具有足够的灵活性，以模拟涉及不同路由方案、拓扑变化和流量矩阵变化的假设场景。为此，我们依靠图神经网络（GNN）模型的能力在以图表示的环境中高效地操作和推广。我们基于GNN的模型RouteNet受到化学领域中使用的消息传递神经网络[12]的启发，能够在整个网络拓扑中传播任何路由方案，并提取当前网络状态的有意义信息。图2显示了模型的示意图。更详细地说，RouteNet将：

（i）给定拓扑

（ii）源-目的路由方案（即端到端路径和链路之间的关系）

（iii）流量矩阵（定义为网络中每对节点之间的带宽）

作为输入，并最终依据当前网络状态生成性能指标（例如，每路径延迟或抖动）。为了实现这一点，RouteNet使用固定维度向量对路径和链路的状态进行编码，并根据路由方案在它们之间传播信息。

![](https://zdd-1300938198.cos.ap-beijing.myqcloud.com//my-picture-bed/20220729143547.png)

> 预发表版本有这个图，看起来作者觉得这张图并未给出新信息，故删除了。

# NETWORK MODELING WITH GNN

## Notation

计算机网络可以由一组链路表示：$N=\{l_i\}, i∈(0，1，…，n_l)$

在网络中的路由方案通过一组路径表示：$R={p_k}, k∈(0，1，…，n_p)$

每个路径被定义为链路组成的序列：$p_k=(l_{k(0)}, …, l_{k(|pk|)})$

其中$k(i)$是路径k中第i个链接的索引。链接和路径的属性（特征）由$x_{l_i}$和$x_{p_i}$表示。

可测量的KPI被建模为随机变量$W_i$和$L_i$，其中前者是端到端延迟，后者是网络中每个信源-目的地对在一段时间内丢包的总数。

## Background on Graph Neural Networks

图神经网络是一种为图结构数据设计的人工神经架构，其中节点、边和整个图可以具有相关的特征向量。GNN最重要的特性是它保留了节点邻接之间的基本拓扑关系（图同构），因此非常适合用于不同的拓扑，而无需重新训练。

在撰写本文时，已经提出了多种GNN架构。最近，**消息传递神经网络MPNN**被提出作为GNN架构的一般家族[21]。大多数现有的GNN模型可以描述为MPNN框架的特例。

MPNN的主要假设是，与节点、边或整个图相关的信息可以编码在固定维向量中，也称为嵌入。MPNN中的正向传递是三个简单函数的组合：
（i） Message

（ii）Update

（iii）Readout

消息函数将节点/边嵌入作为输入，并输出一个信息向量（消息），发送给图中的所有邻居。更新函数从图中的所有邻居收集（求和）消息，并更新节点/边的嵌入。该消息交换被重复T次，最后，读出函数将得到的节点/边缘嵌入生成GNN模型的输出。我们基于这一概念构建RouteNet–一种专门定制的消息传递架构，用于在计算机网络中产生准确的性能估计。

> 作者在正刊中专门加上了这一块，估计是期刊，需要为不懂GNN的人解释。

## Message Passing Architecture Of RouteNet

RouteNet处理可变大小的输入网络拓扑和任意源-目标路由方案，并生成输出端到端性能预测。RouteNet背后的主要假设是，路径级别（例如，延迟或分组丢失等端到端度量）和链路级别（例如，链路延迟、分组丢失率、链路利用率）的信息可以编码为实数的可学习向量（分别为路径和链路状态向量）。注意，路径抽象可能不一定对应于物理路径。它可能是一种通用的端到端交通流。例如，MPLS隧道。基于此假设，RouteNet基于以下原则：

1） 路径的状态取决于路径中所有链路的状态。
2） 链路的状态取决于包括链路在内的所有路径的状态。

假设链路的状态：$h_{l_i}$，是一个未知的隐藏向量。类似地，路径的状态由$h_{p_i}$定义。

我们期望链路状态向量包含有关链路延迟、丢包率、链路利用率等的一些信息。同样，路径状态期望包含有关端到端指标的信息，例如延迟或总损失。
考虑到这些假设，我们可以陈述以下原则：

![](https://zdd-1300938198.cos.ap-beijing.myqcloud.com//my-picture-bed/20220729153506.png)

其中，$f$ 和 $g$ 是未知函数。

众所周知，神经网络可以作为通用函数逼近器。然而，在这种情况下，由于：

（i）等式（1）和（2）定义了隐函数（状态为隐藏变量的非线性方程组），

（ii）这些函数取决于输入路由方案，

（iii）每个函数的维数非常大。这需要大量的训练样本。

**RouteNet是学习$f$ 和 $g$的GNN结构，该结构对于拓扑和路由方案是不变的，使得神经函数近似可行。**

![](https://zdd-1300938198.cos.ap-beijing.myqcloud.com//my-picture-bed/20220729180655.png)

RouteNet的架构能够处理等式（1）和（2）中描述的循环依赖，并支持任意路由方案（在架构中固有地表示）。为了解决循环依赖关系，RouteNet在状态向量上重复相同的操作T次（第7行的循环）。这些步骤表示从初始状态h^0_p和h^0_l到函数不动点的收敛过程。

> 重点：链路和路径是互相依赖的！GNN迭代逼近保证了循环依赖性！

关于路由不变性问题（在图形相关问题的上下文中更一般地称为拓扑不变性）。这需要使用能够表示不同拓扑和大小的图的结构。在我们的例子中，我们旨在以统一的方式表示不同的路由方案。该问题的一种最先进的解决方案[27]提出使用神经消息传递架构，将两者结合起来：拓扑表示为图形，矢量编码链路状态。**在这种情况下，RouteNet可以解释为普通消息传递神经网络的扩展，该神经网络特别适合表示给定路由方案的链路和路径之间的依赖关系（等式（1）和（2））。**

在算法1中，从第3行到第14行的循环表示在链路和路径之间相互交换编码信息（隐藏状态）的消息传递操作。同样，第9行和第12行是更新函数，分别将新收集的信息编码为路径和链接的隐藏状态。路径状态的更新（第9行）是一个简单的分配，而链路的更新（第12行）是一个可训练的神经网络。一般来说，路径更新也可以是一个可训练的神经网络。

该架构提供了表示任何源-目的路由方案的灵活性。这是通过将R（即端到端路径集）直接映射到定义RouteNet架构的链路和路径实体之间的特定消息传递操作来实现的。因此，每个路径从其中包含的所有链接（第5行的循环）收集消息，类似地，每个链接从包含它的所有路径（第12行）接收消息。考虑到穿过同一链路的路径顺序无关紧要，我们对路径级消息聚合使用了简单的求和。然而，在链路的情况下，分组丢失的存在可能意味着形成每个路径的链路中的顺序依赖性。因此，我们使用递归神经网络（RNN）来聚合路径上的链接状态。注意，RNN非常适合捕捉可变大小序列中的依赖关系（例如，文本处理）。这使我们能够对链接的顺序依赖性进行建模，并通过所有路径传播此信息。

此外，使用这些消息聚合函数（RNN和求和）可以显著限制问题的维数。这些函数的目的是收集在每个（链接或路径）实体中接收的任意数量的消息，并将这些信息压缩到固定维度数组（即隐藏状态）中。请注意，链接和路径的隐藏状态的大小是可配置的超参数。
最后，RouteNet中的所有隐藏状态表示一个包含链接和路径状态信息的显式函数。这使得能够利用它们同时推断各种特征。给定一组隐藏状态$h^T_p$和$h^T_l$，可以连接读出神经网络来估计一些路径和/或链路级指标。这通常可以通过使用具有某些层和适当激活函数的普通全连接神经网络来实现。在算法1中，函数$F_p$（第15行）表示一个读出函数，该函数使用路径隐藏状态$h_p$作为输入来预测一些路径级特征$(\hat{y}_p)$。同样，也可以使用链接隐藏状态$h_l$中的信息来推断一些全局属性和链接级特征$(\hat{y}_l)$。

## Delay, Jitter, and Drops Models

延迟和抖动模型是RouteNet首次发布的应用，显示了这种神经架构对各种网络性能指标建模的能力。在[13]中，使用两个经过训练以最小化均方误差的神经网络模型独立建模。虽然这种方法给出了准确的结果，但它将训练时间和模型参数化增加了一倍。此外，它还隐藏了一个事实，即平均延迟和抖动是同一随机过程的两个统计信息–每包延迟。在本文中，我们提出了一个广义概率延迟模型，该模型可以扩展到考虑丢包。

> 预发表版本中分成了两种模型分别表述，正刊中优化概括成一种通用的模型方法，写了一段数学表述，个人感觉只是讲故事，不太感兴趣，就不看了。

# Evaluation

![](https://zdd-1300938198.cos.ap-beijing.myqcloud.com//my-picture-bed/20220729181242.png)

![](https://zdd-1300938198.cos.ap-beijing.myqcloud.com//my-picture-bed/20220729181322.png)

> 中规中矩的分析

# Conclusion

在本文中，我们**提出了RouteNet**，这是一种基于图形神经网络（GNN）的定制架构，专门用于计算机网络建模。RouteNet使用了一种新的消息传递功能，该功能允许GNN捕获由网络拓扑和路由配置产生的路径和链路状态之间的复杂关系，以便对产生的网络性能进行建模。
我们**设计并实现了一个基于广义线性模型的扩展路由网络模型**，该模型预测了网络中每个信源/目的地每个数据包延迟和丢失的分布。根据这些输出分布，我们评估了预测的平均每包延迟、抖动和平均分组丢失的准确性。我们的评估结果表明，RouteNet能够推广到其他网络拓扑、路由配置和流量矩阵，这些在训练中没有出现。
此外，**RouteNet的模块化架构简化了转移学习，转移学习包括重用为特定任务训练的神经网络模型，并对其进行再训练以解决类似领域中的其他问题**。在RouteNet的上下文中，这是在[13]中提出的，其中抖动模型是从延迟模型的早期阶段启动的。
最后，我们**介绍了一些优化用例**，其中我们将RouteNet的性能预测用于不同的网络优化目的。特别是，我们基于延迟、抖动和丢包要求执行QoS感知路由优化，并使用RouteNet在网络规划场景中找到最佳链路位置。

> 总结：
>
> 链路状态向量+路径状态向量的构造方式，感觉还是有用的。后续可以尝试实现一下。

# 参考文献

Rusek K, Suárez-Varela J, Almasan P, et al. RouteNet: Leveraging Graph Neural Networks for network modeling and optimization in SDN[J]. IEEE Journal on Selected Areas in Communications, 2020, 38(10): 2260-2270.

Rusek K, Suárez-Varela J, Mestres A, et al. Unveiling the potential of Graph Neural Networks for network modeling and optimization in SDN[C]//Proceedings of the 2019 ACM Symposium on SDN Research. 2019: 140-151.
